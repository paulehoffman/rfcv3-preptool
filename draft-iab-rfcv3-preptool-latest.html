<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>RFC v3 Prep Tool Description</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.2" rel="Chapter" title="2 v3 Prep Tool Usage Scenarios"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Internet-Draft Submission"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Canonical RFC Preparation"/>
<link href="#rfc.section.5" rel="Chapter" title="5 What the v3 Prep Tool Does"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 XML Sanitization"/>
<link href="#rfc.section.5.1.1" rel="Chapter" title="5.1.1 XInclude Processing"/>
<link href="#rfc.section.5.1.2" rel="Chapter" title="5.1.2 DTD Removal"/>
<link href="#rfc.section.5.1.3" rel="Chapter" title="5.1.3 Processing Instruction Removal"/>
<link href="#rfc.section.5.1.4" rel="Chapter" title="5.1.4 Validity Check"/>
<link href="#rfc.section.5.1.5" rel="Chapter" title="5.1.5 Check &#x201C;anchor&#x201D;"/>
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Defaults"/>
<link href="#rfc.section.5.2.1" rel="Chapter" title="5.2.1 &#x201C;version&#x201D; Insertion"/>
<link href="#rfc.section.5.2.2" rel="Chapter" title="5.2.2 &#x201C;seriesInfo&#x201D; Insertion"/>
<link href="#rfc.section.5.2.3" rel="Chapter" title="5.2.3 &lt;date&gt; Insertion"/>
<link href="#rfc.section.5.2.4" rel="Chapter" title="5.2.4 &#x201C;prepTime&#x201D; Insertion"/>
<link href="#rfc.section.5.2.5" rel="Chapter" title="5.2.5 &lt;ol&gt; Group &#x201C;start&#x201D; Insertion"/>
<link href="#rfc.section.5.2.6" rel="Chapter" title="5.2.6 Attribute Default Value Insertion"/>
<link href="#rfc.section.5.2.7" rel="Chapter" title="5.2.7 Section &#x201C;toc&#x201D; attribute"/>
<link href="#rfc.section.5.2.8" rel="Chapter" title="5.2.8 &#x201C;removeInRFC&#x201D; Warning Paragraph"/>
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Normalization"/>
<link href="#rfc.section.5.3.1" rel="Chapter" title="5.3.1 &#x201C;month&#x201D; Attribute"/>
<link href="#rfc.section.5.3.2" rel="Chapter" title="5.3.2 Document &lt;date&gt;"/>
<link href="#rfc.section.5.3.3" rel="Chapter" title="5.3.3 ASCII Attribute Processing"/>
<link href="#rfc.section.5.3.4" rel="Chapter" title="5.3.4 &#x201C;title&#x201D; Conversion"/>
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Generation"/>
<link href="#rfc.section.5.4.1" rel="Chapter" title="5.4.1 &#x201C;expiresDate&#x201D; Insertion"/>
<link href="#rfc.section.5.4.2" rel="Chapter" title="5.4.2 &lt;boilerplate&gt; Insertion"/>
<link href="#rfc.section.5.4.2.1" rel="Chapter" title="5.4.2.1 &#x2018;Status of this Memo&#x2019; Insertion"/>
<link href="#rfc.section.5.4.2.2" rel="Chapter" title="5.4.2.2 Copyright Insertion"/>
<link href="#rfc.section.5.4.3" rel="Chapter" title="5.4.3 &lt;reference&gt; &#x201C;target&#x201D; Insertion"/>
<link href="#rfc.section.5.4.4" rel="Chapter" title="5.4.4 &lt;displayreference&gt; Processing"/>
<link href="#rfc.section.5.4.5" rel="Chapter" title="5.4.5 &lt;name&gt; Slugification"/>
<link href="#rfc.section.5.4.6" rel="Chapter" title="5.4.6 &lt;reference&gt; Sorting"/>
<link href="#rfc.section.5.4.7" rel="Chapter" title="5.4.7 Part Numbering"/>
<link href="#rfc.section.5.4.8" rel="Chapter" title="5.4.8 &lt;iref&gt; Numbering"/>
<link href="#rfc.section.5.4.9" rel="Chapter" title="5.4.9 &lt;xref&gt; processing"/>
<link href="#rfc.section.5.4.9.1" rel="Chapter" title="5.4.9.1 &#x201C;target&#x201D; Rewriting"/>
<link href="#rfc.section.5.4.9.2" rel="Chapter" title="5.4.9.2 &#x201C;derivedContent&#x201D; Insertion (With Content)"/>
<link href="#rfc.section.5.4.9.3" rel="Chapter" title="5.4.9.3 &#x201C;derivedContent&#x201D; Insertion (Without Content)"/>
<link href="#rfc.section.5.4.10" rel="Chapter" title="5.4.10 &lt;relref&gt; Processing"/>
<link href="#rfc.section.5.4.11" rel="Chapter" title="5.4.11 &lt;displayreference&gt; Removal"/>
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Inclusion"/>
<link href="#rfc.section.5.5.1" rel="Chapter" title="5.5.1 &lt;artwork&gt; Processing"/>
<link href="#rfc.section.5.5.2" rel="Chapter" title="5.5.2 &lt;sourcecode&gt; Processing"/>
<link href="#rfc.section.5.6" rel="Chapter" title="5.6 RFC-mode cleanup"/>
<link href="#rfc.section.5.6.1" rel="Chapter" title="5.6.1 &lt;note&gt; Removal"/>
<link href="#rfc.section.5.6.2" rel="Chapter" title="5.6.2 &lt;cref&gt; Removal"/>
<link href="#rfc.section.5.6.3" rel="Chapter" title="5.6.3 &lt;link&gt; Processing"/>
<link href="#rfc.section.5.6.4" rel="Chapter" title="5.6.4 XML Comment Removal"/>
<link href="#rfc.section.5.6.5" rel="Chapter" title="5.6.5 &#x201C;xml:base&#x201D; and &#x201C;originalSrc&#x201D; Removal"/>
<link href="#rfc.section.5.7" rel="Chapter" title="5.7 Finalization"/>
<link href="#rfc.section.5.7.1" rel="Chapter" title="5.7.1 &#x201C;scripts&#x201D; Insertion"/>
<link href="#rfc.section.5.7.2" rel="Chapter" title="5.7.2 Deprecation Check"/>
<link href="#rfc.section.5.7.3" rel="Chapter" title="5.7.3 Pretty-Format"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Additional Uses for the Prep Tool"/>
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations"/>
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgements"/>
<link href="#rfc.references" rel="Chapter" title="10 Informative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.1 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Hoffman, P. and J. Hildebrand" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-iab-rfcv3-preptool" />
  <meta name="dct.issued" scheme="ISO8601" content="2016-4-26" />
  <meta name="dct.abstract" content="This document describes some aspects of the &#8220;prep tool&#8221; that is expected to be created when the new RFC v3 specification is deployed." />
  <meta name="description" content="This document describes some aspects of the &#8220;prep tool&#8221; that is expected to be created when the new RFC v3 specification is deployed." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">P. Hoffman</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">ICANN</td>
</tr>
<tr>
  <td class="left">Intended status: Informational</td>
  <td class="right">J. Hildebrand</td>
</tr>
<tr>
  <td class="left">Expires: October 28, 2016</td>
  <td class="right">Cisco</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">April 26, 2016</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">RFC v3 Prep Tool Description<br />
  <span class="filename">draft-iab-rfcv3-preptool</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This document describes some aspects of the &#8220;prep tool&#8221; that is expected to be created when the new RFC v3 specification is deployed.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on October 28, 2016.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2016 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>2.   <a href="#rfc.section.2">v3 Prep Tool Usage Scenarios</a></li>
<li>3.   <a href="#rfc.section.3">Internet-Draft Submission</a></li>
<li>4.   <a href="#rfc.section.4">Canonical RFC Preparation</a></li>
<li>5.   <a href="#rfc.section.5">What the v3 Prep Tool Does</a></li>
<ul><li>5.1.   <a href="#rfc.section.5.1">XML Sanitization</a></li>
<ul><li>5.1.1.   <a href="#rfc.section.5.1.1">XInclude Processing</a></li>
<li>5.1.2.   <a href="#rfc.section.5.1.2">DTD Removal</a></li>
<li>5.1.3.   <a href="#rfc.section.5.1.3">Processing Instruction Removal</a></li>
<li>5.1.4.   <a href="#rfc.section.5.1.4">Validity Check</a></li>
<li>5.1.5.   <a href="#rfc.section.5.1.5">Check &#8220;anchor&#8221;</a></li>
</ul><li>5.2.   <a href="#rfc.section.5.2">Defaults</a></li>
<ul><li>5.2.1.   <a href="#rfc.section.5.2.1">&#8220;version&#8221; Insertion</a></li>
<li>5.2.2.   <a href="#rfc.section.5.2.2">&#8220;seriesInfo&#8221; Insertion</a></li>
<li>5.2.3.   <a href="#rfc.section.5.2.3">&lt;date&gt; Insertion</a></li>
<li>5.2.4.   <a href="#rfc.section.5.2.4">&#8220;prepTime&#8221; Insertion</a></li>
<li>5.2.5.   <a href="#rfc.section.5.2.5">&lt;ol&gt; Group &#8220;start&#8221; Insertion</a></li>
<li>5.2.6.   <a href="#rfc.section.5.2.6">Attribute Default Value Insertion</a></li>
<li>5.2.7.   <a href="#rfc.section.5.2.7">Section &#8220;toc&#8221; attribute</a></li>
<li>5.2.8.   <a href="#rfc.section.5.2.8">&#8220;removeInRFC&#8221; Warning Paragraph</a></li>
</ul><li>5.3.   <a href="#rfc.section.5.3">Normalization</a></li>
<ul><li>5.3.1.   <a href="#rfc.section.5.3.1">&#8220;month&#8221; Attribute</a></li>
<li>5.3.2.   <a href="#rfc.section.5.3.2">Document &lt;date&gt;</a></li>
<li>5.3.3.   <a href="#rfc.section.5.3.3">ASCII Attribute Processing</a></li>
<li>5.3.4.   <a href="#rfc.section.5.3.4">&#8220;title&#8221; Conversion</a></li>
</ul><li>5.4.   <a href="#rfc.section.5.4">Generation</a></li>
<ul><li>5.4.1.   <a href="#rfc.section.5.4.1">&#8220;expiresDate&#8221; Insertion</a></li>
<li>5.4.2.   <a href="#rfc.section.5.4.2">&lt;boilerplate&gt; Insertion</a></li>
<ul><li>5.4.2.1.   <a href="#rfc.section.5.4.2.1">&#8216;Status of this Memo&#8217; Insertion</a></li>
<li>5.4.2.2.   <a href="#rfc.section.5.4.2.2">Copyright Insertion</a></li>
</ul><li>5.4.3.   <a href="#rfc.section.5.4.3">&lt;reference&gt; &#8220;target&#8221; Insertion</a></li>
<li>5.4.4.   <a href="#rfc.section.5.4.4">&lt;displayreference&gt; Processing</a></li>
<li>5.4.5.   <a href="#rfc.section.5.4.5">&lt;name&gt; Slugification</a></li>
<li>5.4.6.   <a href="#rfc.section.5.4.6">&lt;reference&gt; Sorting</a></li>
<li>5.4.7.   <a href="#rfc.section.5.4.7">Part Numbering</a></li>
<li>5.4.8.   <a href="#rfc.section.5.4.8">&lt;iref&gt; Numbering</a></li>
<li>5.4.9.   <a href="#rfc.section.5.4.9">&lt;xref&gt; processing</a></li>
<ul><li>5.4.9.1.   <a href="#rfc.section.5.4.9.1">&#8220;target&#8221; Rewriting</a></li>
<li>5.4.9.2.   <a href="#rfc.section.5.4.9.2">&#8220;derivedContent&#8221; Insertion (With Content)</a></li>
<li>5.4.9.3.   <a href="#rfc.section.5.4.9.3">&#8220;derivedContent&#8221; Insertion (Without Content)</a></li>
</ul><li>5.4.10.   <a href="#rfc.section.5.4.10">&lt;relref&gt; Processing</a></li>
<li>5.4.11.   <a href="#rfc.section.5.4.11">&lt;displayreference&gt; Removal</a></li>
</ul><li>5.5.   <a href="#rfc.section.5.5">Inclusion</a></li>
<ul><li>5.5.1.   <a href="#rfc.section.5.5.1">&lt;artwork&gt; Processing</a></li>
<li>5.5.2.   <a href="#rfc.section.5.5.2">&lt;sourcecode&gt; Processing</a></li>
</ul><li>5.6.   <a href="#rfc.section.5.6">RFC-mode cleanup</a></li>
<ul><li>5.6.1.   <a href="#rfc.section.5.6.1">&lt;note&gt; Removal</a></li>
<li>5.6.2.   <a href="#rfc.section.5.6.2">&lt;cref&gt; Removal</a></li>
<li>5.6.3.   <a href="#rfc.section.5.6.3">&lt;link&gt; Processing</a></li>
<li>5.6.4.   <a href="#rfc.section.5.6.4">XML Comment Removal</a></li>
<li>5.6.5.   <a href="#rfc.section.5.6.5">&#8220;xml:base&#8221; and &#8220;originalSrc&#8221; Removal</a></li>
</ul><li>5.7.   <a href="#rfc.section.5.7">Finalization</a></li>
<ul><li>5.7.1.   <a href="#rfc.section.5.7.1">&#8220;scripts&#8221; Insertion</a></li>
<li>5.7.2.   <a href="#rfc.section.5.7.2">Deprecation Check</a></li>
<li>5.7.3.   <a href="#rfc.section.5.7.3">Pretty-Format</a></li>
</ul></ul><li>6.   <a href="#rfc.section.6">Additional Uses for the Prep Tool</a></li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a></li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a></li>
<li>9.   <a href="#rfc.section.9">Acknowledgements</a></li>
<li>10.   <a href="#rfc.references">Informative References</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a></h1>
<p id="rfc.section.1.p.1">For the future of the RFC format, the RFC Editor has decided that XML (using the XML2RFCv3 vocabulary <a href="#I-D.iab-xml2rfc">[I-D.iab-xml2rfc]</a>) is the canonical format, in the sense that it is the data that is blessed by the process as the actual RFC. See <a href="#RFC6949">[RFC6949]</a> for more detail on this.</p>
<p id="rfc.section.1.p.2">Most people will read other formats, such as HTML, PDF, ASCII text, or other formats of the future, however.  In order to ensure each of these formats is as similar as possible to one another as well as the canonical XML, there is a desire that the translation from XML into the other formats will be straightforward syntactic translation. To make that happen, a good amount of data will need to be in the XML format that is not there today. That data will be added by a program called the &#8220;prep tool&#8221;, which will often run as a part of the xml2rfc process.</p>
<p id="rfc.section.1.p.3">This draft specifies the steps that the prep tool will have to take.  As changes to <a href="#I-D.iab-xml2rfc">[I-D.iab-xml2rfc]</a> are made, this document will be updated.</p>
<p id="rfc.section.1.p.4">The details (particularly any vocabularies) described in this document are expected to change based on experience gained in implementing the RFC production center&#8217;s toolset. Revised documents will be published capturing those changes as the toolset is completed. Other implementers must not expect those changes to remain backwards-compatible with the details described in this document.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#v3-prep-tool-usage-scenarios" id="v3-prep-tool-usage-scenarios">v3 Prep Tool Usage Scenarios</a></h1>
<p id="rfc.section.2.p.1">The prep tool will have several settings:</p>
<p/>

<ul>
  <li>Internet-Draft preparation</li>
  <li>Canonical RFC preparation</li>
</ul>
<p id="rfc.section.2.p.3">There are only a few differences between the two settings. For example, the boilerplate output will be different, as will the date output on the front page.</p>
<p id="rfc.section.2.p.4">Note that this only describes what the IETF-sponsored prep tool does. Others might create their own work-alike prep tools for their own formatting needs.  However, an output format developer does not need to change the prep tool in order to create their own formatter: they only need to be able to consume prepared text. The IETF-sponsored prep tool runs in two different modes: &#8220;I-D&#8221; mode when the tool is run during Internet-Draft submission and processing, and &#8220;RFC production mode&#8221; when the tool is run by the RFC Production Center (RPC) while producing an RFC.</p>
<p id="rfc.section.2.p.5">This tool is described as if it is a separate tool so that we can reason about its architectural properties. In actual implementation, it might be a part of a larger suite of functionality.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#internet-draft-submission" id="internet-draft-submission">Internet-Draft Submission</a></h1>
<p id="rfc.section.3.p.1">When the IETF draft submission tool accepts v3 XML as an input format, the submission tool runs the submitted file through the prep tool. This is called &#8220;I-D mode&#8221; in this document. If the tool finds no errors, it keeps two XML files: the submitted file and the prepped file.</p>
<p id="rfc.section.3.p.2">The prepped file provides a record of what a submitter was attesting to at the time of submission. It represents a self-contained record of what any external references resolved to at the time of submission.</p>
<p id="rfc.section.3.p.3">The prepped file is used by the IETF formatters to create outputs such as HTML, PDF, and text (or the tools act in a way indistinguishable from this). The message sent out by the draft submission tool includes a link to the original XML as well as the other outputs, including the prepped XML.</p>
<p id="rfc.section.3.p.4">The prepped XML can be used by tools not yet developed to output new formats that have as similar output as possible to the current IETF formatters. For example, if the IETF creates a .mobi output renderer later, it can run that renderer on all of the prepped XML that has been saved, ensuring that the content of included external references and all of the part numbers and boilerplate will be the same as what was produced by the previous IETF formatters at the time the document was first uploaded.</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#canonical-rfc-preparation" id="canonical-rfc-preparation">Canonical RFC Preparation</a></h1>
<p id="rfc.section.4.p.1">During AUTH48, the RPC will run the prep tool in canonical RFC preparation mode and make the results available to the authors so they can see what the final output might look like. When the document is done with AUTH48 review, the RPC runs the prep tool in canonical RFC preparation mode one last time, locks down the canonicalized XML, runs the formatters for the publication formats, and publishes all of those. It is probably a good idea for the RPC to keep a copy of the input XML file from the various steps of the RFC production process.</p>
<p id="rfc.section.4.p.2">This document assumes that the prep tool will be used in the following manner by the RFC Production Center; they may use something different, or with different configuration.</p>
<p id="rfc.section.4.p.3">Similarly to I-D&#8217;s, the prepped XML can be used later to re-render the output formats, or to generate new formats.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#steps" id="steps">What the v3 Prep Tool Does</a></h1>
<p id="rfc.section.5.p.1">The steps listed here are in order of processing. In all cases where the prep tool would &#8220;add&#8221; an attribute or element, if that attribute or element already exists, the prep tool will check that the attribute or element is correct. If the value is incorrect, the prep tool will warn with the old and new values, then replace the incorrect value with the new value.</p>
<p id="rfc.section.5.p.2">Currently, the IETF uses a tool called &#8220;idnits&#8221; to check text input to the Internet-Drafts publishing process. idnits indicates if it encountered any errors, and also provide text with all of the warnings and errors in a human-readable form. The prep tool should probably check for as many of these errors and warnings as possible when it is processing the XML input. For the moment, tooling might run idnts on the text output from the prepared XML. The list below contains some of those errors and warnings, but the deployed version of the prep tool may contain additional steps to include more or the checks from idnits.</p>
<h1 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> <a href="#sanitization" id="sanitization">XML Sanitization</a></h1>
<p id="rfc.section.5.1.p.1">These steps will ensure that the input document is properly formatted, and that all XML processing has been performed.</p>
<h1 id="rfc.section.5.1.1"><a href="#rfc.section.5.1.1">5.1.1.</a> <a href="#xinclude-processing" id="xinclude-processing">XInclude Processing</a></h1>
<p id="rfc.section.5.1.1.p.1">Process all &lt;x:include&gt; elements. Note: &lt;x:include&gt;d XML may include more &lt;x:include&gt;s (with relative URLs rooted at the xml:base). The tool may be configurable with a limit on the depth of recursion.</p>
<h1 id="rfc.section.5.1.2"><a href="#rfc.section.5.1.2">5.1.2.</a> <a href="#dtd-removal" id="dtd-removal">DTD Removal</a></h1>
<p id="rfc.section.5.1.2.p.1">Fully process any DTDs in the input document, then remove the DTD.  At a minimum, this entails processing the entityrefs and includes for external files.</p>
<h1 id="rfc.section.5.1.3"><a href="#rfc.section.5.1.3">5.1.3.</a> <a href="#pi-removal" id="pi-removal">Processing Instruction Removal</a></h1>
<p id="rfc.section.5.1.3.p.1">Remove processing instructions.</p>
<h1 id="rfc.section.5.1.4"><a href="#rfc.section.5.1.4">5.1.4.</a> <a href="#validity-check" id="validity-check">Validity Check</a></h1>
<p id="rfc.section.5.1.4.p.1">Check the input against the RNG in <a href="#I-D.iab-xml2rfc">[I-D.iab-xml2rfc]</a>. If the input is not valid, give an error.</p>
<h1 id="rfc.section.5.1.5"><a href="#rfc.section.5.1.5">5.1.5.</a> <a href="#check-anchor" id="check-anchor">Check &#8220;anchor&#8221;</a></h1>
<p id="rfc.section.5.1.5.p.1">Check all elements for &#8220;anchor&#8221; attributes. If any &#8220;anchor&#8221; attribute begins with &#8220;s-&#8220;, &#8220;f-&#8220;, &#8220;t-&#8220;, or &#8220;i-&#8220;, give an error.</p>
<h1 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> <a href="#defaults" id="defaults">Defaults</a></h1>
<p id="rfc.section.5.2.p.1">These steps will ensure that all default values have been filled in to the XML, in case the defaults change at a later date.  Steps in this section will not overwrite existing values in the input file.</p>
<h1 id="rfc.section.5.2.1"><a href="#rfc.section.5.2.1">5.2.1.</a> <a href="#version-insertion" id="version-insertion">&#8220;version&#8221; Insertion</a></h1>
<p id="rfc.section.5.2.1.p.1">Ensure that the output has the &#8220;version&#8221; attribute of &lt;rfc&gt;, and that it is set to &#8220;3&#8221;. If there is already a different value, give an error.</p>
<h1 id="rfc.section.5.2.2"><a href="#rfc.section.5.2.2">5.2.2.</a> <a href="#seriesinfo-insertion" id="seriesinfo-insertion">&#8220;seriesInfo&#8221; Insertion</a></h1>
<p id="rfc.section.5.2.2.p.1">If the &lt;front&gt; element of the &lt;rfc&gt; element does not already have a &lt;seriesInfo&gt; element, add a &lt;seriesInfo&gt; element with the name attribute based on the mode in which the preptool is running (&#8220;Internet-Draft&#8221; for Draft mode and &#8220;RFC&#8221; for RFC mode&#8221;) and a value that is the input filename minus any extension for Internet-Drafts, and is a number specified by the RFC Editor for RFCs.</p>
<h1 id="rfc.section.5.2.3"><a href="#rfc.section.5.2.3">5.2.3.</a> <a href="#date-insertion" id="date-insertion">&lt;date&gt; Insertion</a></h1>
<p id="rfc.section.5.2.3.p.1">If the &lt;front&gt; element in the &lt;rfc&gt; element does not contain a &lt;date&gt; element, add it and fill in the &#8220;day&#8221;, &#8220;month&#8221;, and &#8220;year&#8221; attibutes from the current date. If the &lt;front&gt; element in the &lt;rfc&gt; element has a &lt;date&gt; element with &#8220;day&#8221;, &#8220;month&#8221;, and &#8220;year&#8221; attibutes, but the date indicated is more than three days in the past or is in the future, give a warning. If the &lt;front&gt; element in the &lt;rfc&gt; element has a &lt;date&gt; element with some but not all of the &#8220;day&#8221;, &#8220;month&#8221;, and &#8220;year&#8221; attibutes, give an error.</p>
<h1 id="rfc.section.5.2.4"><a href="#rfc.section.5.2.4">5.2.4.</a> <a href="#preptime-insertion" id="preptime-insertion">&#8220;prepTime&#8221; Insertion</a></h1>
<p id="rfc.section.5.2.4.p.1">If the input document includes a &#8220;prepTime&#8221; attribute of &lt;rfc&gt;, exit with an error.</p>
<p id="rfc.section.5.2.4.p.2">Fill in the &#8220;prepTime&#8221; attribute of &lt;rfc&gt; with the current datetime.</p>
<h1 id="rfc.section.5.2.5"><a href="#rfc.section.5.2.5">5.2.5.</a> <a href="#ol-group-start-insertion" id="ol-group-start-insertion">&lt;ol&gt; Group &#8220;start&#8221; Insertion</a></h1>
<p id="rfc.section.5.2.5.p.1">Add a &#8220;start&#8221; attribute to every &lt;ol&gt; element containing a group that does not already have a start.</p>
<h1 id="rfc.section.5.2.6"><a href="#rfc.section.5.2.6">5.2.6.</a> <a href="#attribute-default-value-insertion" id="attribute-default-value-insertion">Attribute Default Value Insertion</a></h1>
<p id="rfc.section.5.2.6.p.1">Fill in any default values for attributes on elements, except &#8220;keepWithNext&#8221; and &#8220;keepWithPrevious&#8221; of &lt;t&gt;, and &#8220;toc&#8221; of &lt;section&gt;.  Some default values can be found in the Relax NG schema, while others can be found in the prose describing the elements in <a href="#I-D.iab-xml2rfc">[I-D.iab-xml2rfc]</a>).</p>
<h1 id="rfc.section.5.2.7"><a href="#rfc.section.5.2.7">5.2.7.</a> <a href="#section-toc" id="section-toc">Section &#8220;toc&#8221; attribute</a></h1>
<p id="rfc.section.5.2.7.p.1">For each &lt;section&gt;, modify the &#8220;toc&#8221; attribute to be either &#8220;include&#8221; or &#8220;exclude&#8221;:</p>
<p/>

<ul>
  <li>for sections that have an ancestor of &lt;boilerplate&gt;, use &#8220;exclude&#8221;</li>
  <li>else for sections that have a descendant that has toc=&#8221;include&#8221;, use &#8220;include&#8221;.  If the section has toc=&#8221;exclude&#8221; in the input, this is an error.</li>
  <li>else for sections that are children of a section with toc=&#8221;exclude&#8221;, use &#8220;exclude&#8221;.</li>
  <li>else for sections that are deeper than rfc/@tocDepth, use &#8220;exclude&#8221;</li>
  <li>else use &#8220;include&#8221;</li>
</ul>
<h1 id="rfc.section.5.2.8"><a href="#rfc.section.5.2.8">5.2.8.</a> <a href="#remove-in-rfc-warning" id="remove-in-rfc-warning">&#8220;removeInRFC&#8221; Warning Paragraph</a></h1>
<p id="rfc.section.5.2.8.p.1">If in I-D mode, if there is a &lt;note&gt; element with a &#8220;removeInRFC&#8221; attribute that has the value &#8220;true&#8221;, add a paragraph to the top of the &lt;note&gt; element with the text &#8220;This note is to be removed before publishing as an RFC.&#8221; unless a paragraph consisting of that exact text already exists.</p>
<h1 id="rfc.section.5.3"><a href="#rfc.section.5.3">5.3.</a> <a href="#normalization" id="normalization">Normalization</a></h1>
<p id="rfc.section.5.3.p.1">These steps will ensure that ideas that can be expressed in multiple different ways in the input document are only found in one way in the prepared document.</p>
<h1 id="rfc.section.5.3.1"><a href="#rfc.section.5.3.1">5.3.1.</a> <a href="#normalize-month-attribute" id="normalize-month-attribute">&#8220;month&#8221; Attribute</a></h1>
<p id="rfc.section.5.3.1.p.1">Normalize the values of &#8220;month&#8221; attributes in all &lt;date&gt; elements in &lt;front&gt; elements in &lt;rfc&gt; elements to numeric values.</p>
<h1 id="rfc.section.5.3.2"><a href="#rfc.section.5.3.2">5.3.2.</a> <a href="#normalize-date" id="normalize-date">Document &lt;date&gt;</a></h1>
<p id="rfc.section.5.3.2.p.1">Normalize the values of &#8220;year&#8221; attributes in all &lt;date&gt; elements in &lt;front&gt; elements in &lt;rfc&gt; elements to be four-digit values.</p>
<h1 id="rfc.section.5.3.3"><a href="#rfc.section.5.3.3">5.3.3.</a> <a href="#ascii-atttribute-processing" id="ascii-atttribute-processing">ASCII Attribute Processing</a></h1>
<p id="rfc.section.5.3.3.p.1">In every &lt;email&gt;, &lt;organization&gt;, &lt;street&gt;, &lt;city&gt;, &lt;region&gt;, &lt;country&gt;, and &lt;code&gt; element, if there is an &#8220;ascii&#8221; attribute and the value of that attribute is the same as the content of the element, remove the &#8220;ascii&#8221; element and issue a warning about the removal.</p>
<p id="rfc.section.5.3.3.p.2">In every &lt;author&gt; element, if there is an &#8220;asciiFullname&#8221;, &#8220;asciiInitials&#8221;, or &#8220;asciiSurname&#8221; attribute, check the content of that element against its matching &#8220;fullname&#8221;, &#8220;initials&#8221;, or &#8220;surname&#8221; element (respectively). If the two are the same, remove the &#8220;ascii*&#8221; elelement and issue a warning about the removal.</p>
<h1 id="rfc.section.5.3.4"><a href="#rfc.section.5.3.4">5.3.4.</a> <a href="#title-conversion" id="title-conversion">&#8220;title&#8221; Conversion</a></h1>
<p id="rfc.section.5.3.4.p.1">For every &lt;section&gt;, &lt;note&gt;, &lt;figure&gt;, &lt;references&gt;, and &lt;texttable&gt; element that has a (deprecated) &#8220;title&#8221; attribute, remove the &#8220;title&#8221; attribute and insert a &lt;name&gt; element with the title from the attribute.</p>
<h1 id="rfc.section.5.4"><a href="#rfc.section.5.4">5.4.</a> <a href="#generation" id="generation">Generation</a></h1>
<p id="rfc.section.5.4.p.1">These steps will generate new content, overriding existing similar content in the input document.  Some of these steps are important enough that they specify a warning to be generated when the content being overwritten does not match the new content.</p>
<h1 id="rfc.section.5.4.1"><a href="#rfc.section.5.4.1">5.4.1.</a> <a href="#expiresdate-insertion" id="expiresdate-insertion">&#8220;expiresDate&#8221; Insertion</a></h1>
<p id="rfc.section.5.4.1.p.1">If in I-D mode, fill in &#8220;expiresDate&#8221; attribute of &lt;rfc&gt; based on the &lt;date&gt; element of the document&#8217;s &lt;front&gt; element.</p>
<h1 id="rfc.section.5.4.2"><a href="#rfc.section.5.4.2">5.4.2.</a> <a href="#boilerplate-insertion" id="boilerplate-insertion">&lt;boilerplate&gt; Insertion</a></h1>
<p id="rfc.section.5.4.2.p.1">Create a &lt;boilerplate&gt; element if it does not exist. If there are any children of the &lt;boilerplate&gt; element, produce a warning that says &#8220;Existing boilerplate being removed. Other tools, specifically the draft submission tool, will treat this condition as an error&#8221; and remove the existing children.</p>
<h1 id="rfc.section.5.4.2.1"><a href="#rfc.section.5.4.2.1">5.4.2.1.</a> <a href="#status-of-this-memo-insertion" id="status-of-this-memo-insertion">&#8216;Status of this Memo&#8217; Insertion</a></h1>
<p id="rfc.section.5.4.2.1.p.1">Add the &#8220;Status of this Memo&#8221; section to the &lt;boilerplate&gt; element with current values. The application will use the &#8220;submissionType&#8221;, and &#8220;consensus&#8221; attributes of the &lt;rfc&gt; element, the &lt;workgroup&gt; element, and the &#8220;status&#8221; and &#8220;stream&#8221; attributes of the &lt;seriesInfo&gt; element, to determine which <a href="#I-D.iab-rfc5741bis">[I-D.iab-rfc5741bis]</a> boilerplate to include, as described in Appendix A of <a href="#I-D.iab-xml2rfc">[I-D.iab-xml2rfc]</a>.</p>
<h1 id="rfc.section.5.4.2.2"><a href="#rfc.section.5.4.2.2">5.4.2.2.</a> <a href="#copyright-insertion" id="copyright-insertion">Copyright Insertion</a></h1>
<p id="rfc.section.5.4.2.2.p.1">Add the &#8220;Copyright Notice&#8221; section to the &lt;boilerplate&gt; element. The application will use the &#8220;ipr&#8221; and &#8220;submissionType&#8221; attributes of the &lt;rfc&gt; element and the &lt;date&gt; element to determine which portions and which version of the TLP to use, as described in A.1 of <a href="#I-D.iab-xml2rfc">[I-D.iab-xml2rfc]</a>.</p>
<h1 id="rfc.section.5.4.3"><a href="#rfc.section.5.4.3">5.4.3.</a> <a href="#reference-target-insertion" id="reference-target-insertion">&lt;reference&gt; &#8220;target&#8221; Insertion</a></h1>
<p id="rfc.section.5.4.3.p.1">For any &lt;reference&gt; element that does not already have a &#8220;target&#8221; attribute, fill the target attribute in if the element has one or more &lt;seriesinfo&gt; child element(s) and the &#8220;name&#8221; attribute of the &lt;seriesinfo&gt; element is &#8220;RFC&#8221;, &#8220;Internet-Draft&#8221;, or &#8220;DOI&#8221; or other value for which it is clear what the &#8220;target&#8221; should be. The particular URLs for RFCs, Internet-Drafts, and DOIs for this step will be specified later by the RFC Editor and the IESG. These URLs might also be different before and after the v3 format is adopted.</p>
<h1 id="rfc.section.5.4.4"><a href="#rfc.section.5.4.4">5.4.4.</a> <a href="#displayreference-processing" id="displayreference-processing">&lt;displayreference&gt; Processing</a></h1>
<p id="rfc.section.5.4.4.p.1">For each &lt;reference&gt; or &lt;referencegroup&gt; that has an associated &lt;displayreference&gt;, replace the value of the &#8220;anchor&#8221; attribute with the value of the &#8220;to&#8221; attribute of the associated &lt;displayreference&gt;.</p>
<h1 id="rfc.section.5.4.5"><a href="#rfc.section.5.4.5">5.4.5.</a> <a href="#name-slugification" id="name-slugification">&lt;name&gt; Slugification</a></h1>
<p id="rfc.section.5.4.5.p.1">Add a &#8220;slugifiedName&#8221; attribute to each &lt;name&gt; element that does not contain one; replace the attribute if it contains a value that begins with &#8220;n-&#8220;.</p>
<h1 id="rfc.section.5.4.6"><a href="#rfc.section.5.4.6">5.4.6.</a> <a href="#reference-sorting" id="reference-sorting">&lt;reference&gt; Sorting</a></h1>
<p id="rfc.section.5.4.6.p.1">If the &#8220;sortRefs&#8221; attribute of the &lt;rfc&gt; element is true, sort the &lt;reference&gt;s and &lt;referencegroup&gt;s lexically by the value of the &#8220;anchor&#8221; attribute, as modified by the &#8220;to&#8221; attribute of any &lt;displayreference&gt; element. The RFC Editor needs to determine what the rules for lexical sorting are. The authors of this document acknowledge that getting consensus on this will be a difficult task.</p>
<h1 id="rfc.section.5.4.7"><a href="#rfc.section.5.4.7">5.4.7.</a> <a href="#part-numbering" id="part-numbering">Part Numbering</a></h1>
<p id="rfc.section.5.4.7.p.1">Add &#8220;pn&#8221; attributes for all parts.  Parts are: * &lt;section&gt; in &lt;middle&gt;: pn=&#8217;s-1.4.2&#8217; * &lt;references&gt;: pn=&#8217;s-12&#8217; or pn=&#8217;s-12.1&#8217; * &lt;abstract&gt;: pn=&#8217;s-abstract&#8217; * &lt;note&gt;: pn=&#8217;s-note-2&#8217; * &lt;section&gt; in &lt;boilerplate&gt;: pn=&#8217;s-boilerplate-1&#8217; * &lt;table&gt;: pn=&#8217;t-3&#8217; * &lt;figure&gt;: pn=&#8217;f-4&#8217; * &lt;artwork&gt;, &lt;aside&gt;, &lt;blockquote&gt;, &lt;dt&gt;, &lt;li&gt;, &lt;sourcecode&gt;, &lt;t&gt;: pn=&#8217;p-[section]-[counter]&#8217;</p>
<h1 id="rfc.section.5.4.8"><a href="#rfc.section.5.4.8">5.4.8.</a> <a href="#iref-numbering" id="iref-numbering">&lt;iref&gt; Numbering</a></h1>
<p id="rfc.section.5.4.8.p.1">In every &lt;iref&gt; element, create a document-unique &#8220;pn&#8221; attribute.  The value of the &#8220;pn&#8221; attribute will start with &#8216;i-&#8216;, and use the item attribute, the subitem attribute (if it exists), and a counter to ensure uniqueness. For example, the first instance of &#8220;&lt;iref item=&#8217;foo&#8217; subitem=&#8217;bar&#8217;&gt;&#8221; will get the irefid &#8216;i-foo-bar-1&#8217;.</p>
<h1 id="rfc.section.5.4.9"><a href="#rfc.section.5.4.9">5.4.9.</a> <a href="#xref-processing" id="xref-processing">&lt;xref&gt; processing</a></h1>
<h1 id="rfc.section.5.4.9.1"><a href="#rfc.section.5.4.9.1">5.4.9.1.</a> <a href="#xref-target-rewriting" id="xref-target-rewriting">&#8220;target&#8221; Rewriting</a></h1>
<p id="rfc.section.5.4.9.1.p.1">For each &lt;xref&gt; element referring to a &lt;reference&gt; or &lt;referencegroup&gt; that has an associated &lt;displayreference&gt;, modify the &#8220;target&#8221; attribute of the &lt;xref&gt; to match the &#8220;to&#8221; attribute of the associated &lt;displayreference&gt;.</p>
<h1 id="rfc.section.5.4.9.2"><a href="#rfc.section.5.4.9.2">5.4.9.2.</a> <a href="#xref-derivedcontent-insertion-with-content" id="xref-derivedcontent-insertion-with-content">&#8220;derivedContent&#8221; Insertion (With Content)</a></h1>
<p id="rfc.section.5.4.9.2.p.1">For each &lt;xref&gt; element that has content, fill the &#8220;derivedContent&#8221; with the element content, having first trimmed the whitespace from ends of content text. Issue a warning if the &#8220;derivedContent&#8221; attribute already exists and has a different value from what was being filled in.</p>
<h1 id="rfc.section.5.4.9.3"><a href="#rfc.section.5.4.9.3">5.4.9.3.</a> <a href="#xref-derivedcontent-insertion-without-content" id="xref-derivedcontent-insertion-without-content">&#8220;derivedContent&#8221; Insertion (Without Content)</a></h1>
<p id="rfc.section.5.4.9.3.p.1">For each &lt;xref&gt; element that does not have content, fill the &#8220;derivedContent&#8221; based on the &#8220;format&#8221; attribute.  * For format=&#8217;counter&#8217;, the &#8220;derivedContent&#8221; is the section, figure, table, or ordered list number of the element with anchor equal to the xref target.</p>
<p/>

<ul>
  <li>For format=&#8217;default&#8217; and the &#8220;target&#8221; attribute points to a &lt;reference&gt; or &lt;referencegroup&gt; element, the &#8220;derivedContent&#8221; is the value of the &#8220;target&#8221; attribute (or the &#8220;to&#8221; attribute of a &lt;displayreference&gt; element for the targeted &lt;reference&gt;).</li>
  <li>For format=&#8217;default&#8217; and the &#8220;target&#8221; attribute points to a &lt;section&gt;, &lt;figure&gt;, or &lt;table&gt;, the &#8220;derivedContent&#8221; is the name of the thing pointed to, such as &#8220;Section 2.3&#8221;, &#8220;Figure 12&#8221;, or &#8220;Table 4&#8221;.</li>
  <li>For format=&#8217;title&#8217;, if the target is a &lt;reference&gt; element, the &#8220;derivedContent&#8221; attribute is the name of the reference, extracted from the &lt;title&gt; child of the &lt;front&gt; child of the reference.</li>
  <li>For format=&#8217;title&#8217;, if the target element has a &lt;name&gt; child element, the &#8220;derivedContent&#8221; attribute is the text content of that &lt;name&gt; element concatenated with the text content of each descendant node of &lt;name&gt; (that is, stripping out all of the XML markup, leaving only the text).</li>
  <li>For format=&#8217;title&#8217;, if the target element does not contain a &lt;name&gt; child element, the &#8220;derivedContent&#8221; attribute is the value of the &#8220;target&#8221; attribute with no other adornment.  Issue a warning if the &#8220;derivedContent&#8221; attribute already exists and has a different value from what was being filled in.</li>
</ul>
<h1 id="rfc.section.5.4.10"><a href="#rfc.section.5.4.10">5.4.10.</a> <a href="#relref-processing" id="relref-processing">&lt;relref&gt; Processing</a></h1>
<p id="rfc.section.5.4.10.p.1">For each &lt;relref&gt; element referring to a &lt;reference&gt; that has an associated &lt;displayreference&gt;, modify the &#8220;target&#8221; attribute of the &lt;relref&gt; to match the &#8220;to&#8221; attribute of the associated &lt;displayreference&gt;.</p>
<p id="rfc.section.5.4.10.p.2">If any &lt;relref&gt; element&#8217;s &#8220;target&#8221; attribute refers to anything but a &lt;reference&gt; element, give an error.</p>
<p id="rfc.section.5.4.10.p.3">For each &lt;relref&gt; element, fill in the &#8220;derivedLink&#8221; attribute.</p>
<p id="rfc.section.5.4.10.p.4">For each &lt;relref&gt; element, if there is no &#8220;relative&#8221; attribute but the target is a v3 RFC or Internet-Draft, create the &#8220;relative&#8221; attribute from the &#8220;section&#8221; attribute.</p>
<h1 id="rfc.section.5.4.11"><a href="#rfc.section.5.4.11">5.4.11.</a> <a href="#displayreference-removal" id="displayreference-removal">&lt;displayreference&gt; Removal</a></h1>
<p id="rfc.section.5.4.11.p.1">Remove every &lt;displayreference&gt; element.</p>
<h1 id="rfc.section.5.5"><a href="#rfc.section.5.5">5.5.</a> <a href="#inclusion" id="inclusion">Inclusion</a></h1>
<p id="rfc.section.5.5.p.1">These steps will include external files into the output document.</p>
<h1 id="rfc.section.5.5.1"><a href="#rfc.section.5.5.1">5.5.1.</a> <a href="#artwork-processing" id="artwork-processing">&lt;artwork&gt; Processing</a></h1>
<p/>

<ol>
  <li>If an &lt;artwork&gt; element has a &#8220;src&#8221; attribute where no scheme is specified, copy the &#8220;src&#8221; attribute value to the &#8220;originalSrc&#8221; attribute, and replace the &#8220;src&#8221; value with a URI that uses the &#8220;file:&#8221; scheme in a path relative to the file being processed. Do not include the full path in the &#8220;src&#8221; attribute. See <a href="#securitycons">Section 8</a> for warnings about this step. This will likely be one of the most common authoring approaches.</li>
  <li>If an &lt;artwork&gt; element has a &#8220;src&#8221; attribute with a &#8220;file:&#8221; scheme, and if processing the URL would cause the processor to retrieve a file that is not in the same directory, or a subdirectory, as the file being processed, give an error. If the &#8220;src&#8221; has any shellmeta strings (such as &#8220;`&#8221;, &#8220;$USER&#8221;, and so on) that would be processed , give an error. Replace the &#8220;src&#8221; attribute with a URI that uses the &#8220;file:&#8221; scheme in a path relative to the file being processed.  This rule attempts to prevent &lt;artwork src=&#8217;file:///etc/passwd&#8217;&gt; and similar security issues. See <a href="#securitycons">Section 8</a> for warnings about this step.</li>
  <li>If an &lt;artwork&gt; element has a &#8220;src&#8221; attribute, and the element has content, give an error.</li>
  <li>If an &lt;artwork&gt; element has type=&#8217;svg&#8217; and there is a &#8220;src&#8221; attribute, the data needs to be moved into the content of the &lt;artwork&gt; element.  <ul><li>If the &#8220;src&#8221; URI scheme is &#8220;data:&#8221;, fill the content of the &lt;artwork&gt; element with that data and remove the &#8220;src&#8221; attribute.</li><li>If the &#8220;src&#8221; URI scheme is &#8220;file:&#8221;, &#8220;http:&#8221;, or &#8220;https:&#8221;, fill the content of the &lt;artwork&gt; element with the resolved XML from the URI in the &#8220;src&#8221; attribute. If there is no &#8220;originalSrc&#8221; attribute, add an &#8220;originalSrc&#8221; attribute with the value of the URI and remove the &#8220;src&#8221; attribute.</li></ul></li>
  <li>If an &lt;artwork&gt; element has type=&#8217;binary-art&#8217;, the data needs to be in a &#8220;src&#8221; attribute with a URI scheme of &#8220;data:&#8221;. If the &#8220;src&#8221; URI scheme is &#8220;file:&#8221;, &#8220;http:&#8221;, or &#8220;https:&#8221;, resolve the URL. Replace the &#8220;src&#8221; attribute with a &#8220;data:&#8221; URI, and add an &#8220;originalSrc&#8221; attribute with the value of the URI. For the &#8220;http:&#8221; and &#8220;https:&#8221; URI schemes, the mediatype of the &#8220;data:&#8221; URI will be the Content-Type of the HTTP response. For the &#8220;file:&#8221; URI scheme, the mediatype of the &#8220;data:&#8221; URI needs to be guessed with heuristics (this is possibly a bad idea). This also fails for content that includes binary images but uses a type other than &#8220;binary-art&#8221;. Note: since this feature can&#8217;t be used for RFCs at the moment, this entire feature might be de-prioritized.</li>
  <li>If an &lt;artwork&gt; element does not have type=&#8217;svg&#8217; or type=&#8217;binary-art&#8217; and there is a &#8220;src&#8221; attribute, the data needs to be moved into the content of the &lt;artwork&gt; element. Note that this step assumes that all of the preferred types other than &#8220;binary-art&#8221; are text, which is possibly wrong.  <ul><li>If the &#8220;src&#8221; URI scheme is &#8220;data:&#8221;, fill the content of the &lt;artwork&gt; element with the correctly-escaped form of that data and remove the &#8220;src&#8221; attribute.</li><li>If the &#8220;src&#8221; URI scheme is &#8220;file:&#8221;, &#8220;http:&#8221;, or &#8220;https:&#8221;, fill the content of the &lt;artwork&gt; element with the correctly-escaped form of the resolved text from the URI in the &#8220;src&#8221; attribute.  If there is no &#8220;originalSrc&#8221; attribute, add an &#8220;originalSrc&#8221; attribute with the value of the URI and remove the &#8220;src&#8221; attribute.</li></ul></li>
</ol>
<h1 id="rfc.section.5.5.2"><a href="#rfc.section.5.5.2">5.5.2.</a> <a href="#sourcecode-processing" id="sourcecode-processing">&lt;sourcecode&gt; Processing</a></h1>
<p/>

<ol>
  <li>If a &lt;sourcecode&gt; element has a &#8220;src&#8221; attribute where no scheme is specified, treat the scheme as &#8220;file:&#8221; in a path relative to the file being processed and replace the &#8220;src&#8221; attribute with a &#8220;file:&#8221; URI.</li>
  <li>If a &lt;sourcecode&gt; element has a &#8220;src&#8221; attribute with a &#8220;file:&#8221; scheme, and if processing the URL would cause the processor to retrieve a file that is not in the same directory, or a subdirectory, as the file being processed, give an error.  This rule attempts to prevent &lt;sourcecode src=&#8217;file:///etc/passwd&#8217;&gt; and similar security issues.</li>
  <li>If a &lt;sourcecode&gt; element has a &#8220;src&#8221; attribute, and the element has content, give an error.</li>
  <li>If a &lt;sourcecode&gt; element has a &#8220;src&#8221; attribute, the data needs to be moved into the content of the &lt;sourcecode&gt; element.  <ul><li>If the &#8220;src&#8221; URI scheme is &#8220;data:&#8221;, fill the content of the &lt;sourcecode&gt; element with the appropriately-escaped data and remove the &#8220;src&#8221; attribute.</li><li>If the &#8220;src&#8221; URI scheme is &#8220;file:&#8221;, &#8220;http:&#8221;, or &#8220;https:&#8221;, fill the content of the &lt;sourcecode&gt; element with the appropriately-escaped resolved text from the URI in the &#8220;src&#8221; attribute.  If there is no &#8220;originalSrc&#8221; attribute, add an &#8220;originalSrc&#8221; attribute with the value of the URI and remove the &#8220;src&#8221; attribute.</li></ul></li>
</ol>
<h1 id="rfc.section.5.6"><a href="#rfc.section.5.6">5.6.</a> <a href="#rfc-mode-cleanup" id="rfc-mode-cleanup">RFC-mode cleanup</a></h1>
<p id="rfc.section.5.6.p.1">These steps provide extra cleanup of the output document in RFC production mode.</p>
<h1 id="rfc.section.5.6.1"><a href="#rfc.section.5.6.1">5.6.1.</a> <a href="#note-removal" id="note-removal">&lt;note&gt; Removal</a></h1>
<p id="rfc.section.5.6.1.p.1">If in RFC production mode, if there is a &lt;note&gt; element with a &#8220;removeInRFC&#8221; attribute that has the value &#8220;true&#8221;, remove the &lt;note&gt; element.</p>
<h1 id="rfc.section.5.6.2"><a href="#rfc.section.5.6.2">5.6.2.</a> <a href="#cref-removal" id="cref-removal">&lt;cref&gt; Removal</a></h1>
<p id="rfc.section.5.6.2.p.1">If in RFC production mode, remove all &lt;cref&gt; elements.</p>
<h1 id="rfc.section.5.6.3"><a href="#rfc.section.5.6.3">5.6.3.</a> <a href="#link-processing" id="link-processing">&lt;link&gt; Processing</a></h1>
<p/>

<ol>
  <li>If in RFC production mode, remove all &lt;link&gt; elements whose &#8220;rel&#8221; attribute has the value &#8220;alternate&#8221;.</li>
  <li>If in RFC production mode, check if there is a &lt;link&gt; element with the current ISSN for the RFC series (2070-1721); if not, add &lt;link rel=&#8221;item&#8221; href=&#8221;urn:issn:2070-1721&#8221;&gt;.</li>
  <li>If in RFC production mode, check if there is a &lt;link&gt; element with a DOI for this RFC; if not, add one of the form &lt;link rel=&#8221;describedBy&#8221; href=&#8221;https://dx.doi.org/10.17487/rfcdddd&#8221;&gt;.</li>
  <li>If in RFC production mode, check if there is a &lt;link&gt; element with the file name of the Internet-Draft that became this RFC the form &lt;link rel=&#8221;convertedFrom&#8221; href=&#8221;https://datatracker.ietf.org/doc/draft-tttttttttt/&#8221;&gt;.  If one does not exist, give an error.</li>
</ol>
<h1 id="rfc.section.5.6.4"><a href="#rfc.section.5.6.4">5.6.4.</a> <a href="#xml-comment-removal" id="xml-comment-removal">XML Comment Removal</a></h1>
<p id="rfc.section.5.6.4.p.1">If in RFC production mode, remove XML comments.</p>
<h1 id="rfc.section.5.6.5"><a href="#rfc.section.5.6.5">5.6.5.</a> <a href="#base-originalsrc-removal" id="base-originalsrc-removal">&#8220;xml:base&#8221; and &#8220;originalSrc&#8221; Removal</a></h1>
<p id="rfc.section.5.6.5.p.1">If in RFC production mode, remove all &#8220;xml:base&#8221; or &#8220;originalSrc&#8221; attributes from all elements.</p>
<h1 id="rfc.section.5.7"><a href="#rfc.section.5.7">5.7.</a> <a href="#finalization" id="finalization">Finalization</a></h1>
<p id="rfc.section.5.7.p.1">These steps provide the finishing touches on the output document.</p>
<h1 id="rfc.section.5.7.1"><a href="#rfc.section.5.7.1">5.7.1.</a> <a href="#scripts-insertion" id="scripts-insertion">&#8220;scripts&#8221; Insertion</a></h1>
<p id="rfc.section.5.7.1.p.1">Determine all the characters used in the document, and fill in the &#8220;scripts&#8221; attribute for &lt;rfc&gt;.</p>
<h1 id="rfc.section.5.7.2"><a href="#rfc.section.5.7.2">5.7.2.</a> <a href="#deprecation-check" id="deprecation-check">Deprecation Check</a></h1>
<p id="rfc.section.5.7.2.p.1">If in RFC production mode, ensure that the result is in full compliance to v3 schema, without any deprecated elements or attributes, and give an error if any issues are found.</p>
<h1 id="rfc.section.5.7.3"><a href="#rfc.section.5.7.3">5.7.3.</a> <a href="#pretty" id="pretty">Pretty-Format</a></h1>
<p id="rfc.section.5.7.3.p.1">Pretty-format the XML output.  (Note: tools like <a href="https://github.com/hildjj/dentin">https://github.com/hildjj/dentin</a> do an adequate job.)</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#additional-uses-for-the-prep-tool" id="additional-uses-for-the-prep-tool">Additional Uses for the Prep Tool</a></h1>
<p id="rfc.section.6.p.1">There will be a need for Internet-Draft authors who include files from their local disk (such as for &lt;artwork src=&#8221;mydrawing.svg&#8221;/&gt;) to have the contents of those files inlined to their drafts before submitting them to the Internet-Draft processor. (There is a possibility that the Internet-Draft processor will allow XML files and accompanying files to be submitted at the same time, but this seems troublesome from a security, portability, and complexity standpoint.) For these users, having a local copy of the prep tool that has an option to just inline all local files would be terribly useful. That option would be a proper subset of the steps given in <a href="#steps">Section 5</a>.</p>
<p id="rfc.section.6.p.2">A feature that might be useful in a local prep tool would be the inverse of the &#8220;just inline&#8221; option would be &#8220;extract all&#8221;. This would allow a user who has a v3 RFC or Internet-Draft to dump all of the &lt;artwork&gt; and &lt;sourcecode&gt; elements into local files instead of having to find each one in the XML. This option might even do as much validation as possible on the extracted &lt;sourcecode&gt; elements.  This feature might also remove some of the features added by the prep tool (such as part numbers and slugifiedName&#8217;s starting with &#8220;n-&#8220;) in order to make the resulting file easier to edit.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#ianacons" id="ianacons">IANA Considerations</a></h1>
<p id="rfc.section.7.p.1">None.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#securitycons" id="securitycons">Security Considerations</a></h1>
<p id="rfc.section.8.p.1">Steps in this document attempt to prevent the &lt;artwork&gt; and &lt;sourcecode&gt; entities from exposing the contents of files outside the directory in which the document being processed resides. For example, values starting with &#8220;/&#8221;, &#8220;./&#8221;, or &#8220;../&#8221; should generate errors.</p>
<p id="rfc.section.8.p.2">The security considerations in <a href="#RFC3470">[RFC3470]</a> apply here. In specific, processing XML external references can expose a prep tool implementation to various threats by causing the implementation to access external resources automatically. It is important to disallow arbitrary access to such external references within XML data from untrusted sources.</p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a></h1>
<p id="rfc.section.9.p.1">Many people contributed valuable ideas to this document. Special thanks go to Robert Sparks for his in-depth review and contributions early in the development of this document.</p>
<h1 id="rfc.references"><a href="#rfc.references">10.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.iab-rfc5741bis">[I-D.iab-rfc5741bis]</b>
      </td>
      <td class="top"><a>Halpern, J.</a>, <a>Daigle, L.</a> and <a>O. Kolkman</a>, "<a href="http://tools.ietf.org/html/draft-iab-rfc5741bis-02">On RFC Streams, Headers, and Boilerplates</a>", Internet-Draft draft-iab-rfc5741bis-02, February 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.iab-xml2rfc">[I-D.iab-xml2rfc]</b>
      </td>
      <td class="top"><a>Hoffman, P.</a>, "<a href="http://tools.ietf.org/html/draft-iab-xml2rfc-03">The "xml2rfc" version 3 Vocabulary</a>", Internet-Draft draft-iab-xml2rfc-03, February 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3470">[RFC3470]</b>
      </td>
      <td class="top"><a>Hollenbeck, S.</a>, <a>Rose, M.</a> and <a>L. Masinter</a>, "<a href="http://tools.ietf.org/html/rfc3470">Guidelines for the Use of Extensible Markup Language (XML) within IETF Protocols</a>", BCP 70, RFC 3470, DOI 10.17487/RFC3470, January 2003.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6949">[RFC6949]</b>
      </td>
      <td class="top"><a>Flanagan, H.</a> and <a>N. Brownlee</a>, "<a href="http://tools.ietf.org/html/rfc6949">RFC Series Format Requirements and Future Development</a>", RFC 6949, DOI 10.17487/RFC6949, May 2013.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Paul Hoffman</span> 
	  <span class="n hidden">
		<span class="family-name">Hoffman</span>
	  </span>
	</span>
	<span class="org vcardline">ICANN</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:paul.hoffman@icann.org">paul.hoffman@icann.org</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Joe Hildebrand</span> 
	  <span class="n hidden">
		<span class="family-name">Hildebrand</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jhildebr@cisco.com">jhildebr@cisco.com</a></span>

  </address>
</div>

</body>
</html>
